<Project>

    <Target Name="CreateGitIgnore" BeforeTargets="PrepareForBuild">
        <WriteLinesToFile
            Condition="!Exists('$(ModuleWwwRootDirectory).gitignore')"
            File="$(ModuleWwwRootDirectory).gitignore"
            Lines="$(ModuleLazyDirectoryName)/;_lazy.json"/>
    </Target>

    <Target Name="CleanBin" BeforeTargets="Clean;Rebuild">
        <RemoveDir Directories="$(ModuleLazyDirectory)" />
    </Target>

    <UsingTask TaskName="LoadDLLInfo" AssemblyFile="$(_NugetPackageBuildBinDirectory)ManifestGenerator.dll" Condition="Exists('$(_NugetPackageBuildBinDirectory)ManifestGenerator.dll')" />

    <Target Name="CopyDependencies" AfterTargets="Build">

        <PropertyGroup>
            <ProjectOutDir>$(MSBuildProjectDirectory)/$(OutDir)</ProjectOutDir>
        </PropertyGroup>

        <LoadDLLInfo
            AssemblyName="$(MSBuildProjectName)"
            AssemblyPaths="$(ProjectOutDir);$(_NugetPackageBuildBinDirectory)"
            JsonManifestPath="$(ModuleManifestPath)" />

        <ItemGroup>
            <OutputFiles Include="$(ProjectOutDir)**/*.*" />
            <OutputFiles Include="@(ReferenceCopyLocalPaths)" />
        </ItemGroup>

        <Copy
            SourceFiles="@(OutputFiles)"
            DestinationFolder="$(ModuleLazyDirectory)"
            OverwriteReadOnlyFiles="true"
            SkipUnchangedFiles="false" />

    </Target>

</Project>
