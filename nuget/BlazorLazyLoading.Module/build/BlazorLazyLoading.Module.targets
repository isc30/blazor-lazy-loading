<Project>

    <Target Name="CreateGitIgnore" BeforeTargets="PrepareForBuild">
        <WriteLinesToFile
            Condition="!Exists('$(ModuleWwwRootDirectory).gitignore')"
            File="$(ModuleWwwRootDirectory).gitignore"
            Lines="$(ModuleLazyDirectoryName)/;$(ModuleLazyManifestFile)"/>
    </Target>

    <Target Name="CleanBin" BeforeTargets="Clean;Rebuild">
        <RemoveDir Directories="$(ModuleLazyDirectory)" />
    </Target>

    <UsingTask TaskName="GenerateManifest" AssemblyFile="$(_BLLNugetPackageBuildBinDirectory)ManifestGenerator.dll" />

    <Target Name="CopyDependencies" AfterTargets="Build">

        <PropertyGroup>
            <ProjectOutDir>$(MSBuildProjectDirectory)/$(OutDir)</ProjectOutDir>
        </PropertyGroup>

        <ItemGroup>
            <ManifestGeneratorAssemblyNames Include="@(ProjectReference->'%(Name)')" />
        </ItemGroup>

        <GenerateManifest
            AssemblyNames="@(ManifestGeneratorAssemblyNames)"
            AssemblyPaths="$(ProjectOutDir);@(ManifestGeneratorAssemblyPaths)"
            ManifestOutputPath="$(ModuleManifestPath)" />

        <ItemGroup>
            <OutputFiles Include="$(ProjectOutDir)**/*.*" />
            <OutputFiles Include="@(ReferenceCopyLocalPaths)" />
        </ItemGroup>

        <Copy
            SourceFiles="@(OutputFiles)"
            DestinationFolder="$(ModuleLazyDirectory)"
            OverwriteReadOnlyFiles="true"
            SkipUnchangedFiles="false" />

    </Target>

</Project>
